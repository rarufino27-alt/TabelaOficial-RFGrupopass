<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resumo â€“ RF DRIVER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="./theme/theme.css">
<link rel="stylesheet" href="./theme/layout.css">
<link rel="stylesheet" href="./theme/components.css">

<style>
.page{
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:20px;
}

.container{
  width:100%;
  max-width:420px;
  display:flex;
  flex-direction:column;
  gap:18px;
}

.header{
  padding:18px;
  border-radius:22px;
  background:linear-gradient(180deg,var(--card),#0b2238);
  color:#fff;
  text-align:center;
}

.header h1{
  font-size:1.6rem;
  font-weight:800;
  color:#fff;
}

.route,.block{
  background:#ffffff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}

.details div{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-size:.9rem;
}

.totalBox{
  background:linear-gradient(180deg,var(--card),#0b2238);
  border-radius:22px;
  padding:22px;
  color:#fff;
  text-align:center;
}

.total{
  font-size:2.4rem;
  font-weight:800;
}

.btn-primary{
  padding:18px;
  border-radius:18px;
  border:none;
  background:linear-gradient(145deg,var(--gold-light),var(--gold));
  font-size:1.05rem;
  font-weight:800;
  color:#0b1b2b;
}

  .block-dark{
  background:linear-gradient(180deg,var(--card),#0b2238);
  color:#ffffff;
}

.block-dark strong{
  color:#ffffff;
}

.select-dark{
  margin-top:10px;
  background:#ffffff;
  color:#0b1b2b;
}
</style>
</head>

<body>

<div class="page">
<div class="container">

<div class="header">
  <h1>Resumo da Viagem</h1>
  <span>Confirme as informaÃ§Ãµes</span>
</div>

<div class="route">
  <strong>ğŸ“Œ Origem</strong><br>
  <span id="origemTxt"></span>
  <hr>
  <strong>ğŸ Destino</strong><br>
  <span id="destinoTxt"></span>
</div>

<div class="block">
  <strong>ğŸ“‹ Detalhamento</strong>
  <div class="details" id="detalhamento"></div>
</div>

  <div class="block" id="blocoObservacao" style="display:none;">
  <strong>ğŸ“ ObservaÃ§Ã£o</strong>
  <div id="observacaoTxt" style="margin-top:8px;font-size:.9rem;"></div>
</div>

<div class="block block-dark">
  <strong>ğŸ’³ Forma de Pagamento</strong>
  <select id="formaPagamento" class="select-dark">
    <option value="Dinheiro">Dinheiro</option>
    <option value="Pix">Pix</option>
    <option value="CartÃ£o">CartÃ£o</option>
  </select>
</div>

<div class="totalBox">
  <div class="total" id="total">R$ 0,00</div>
</div>

<button class="btn-primary" onclick="enviarWhatsApp()">
  Solicitar Viagem
</button>

</div>
</div>

<script src="core/global.js"></script>
<script src="core/taxas.js"></script>
<script src="core/dinamico.js"></script>

<script>
const origem = App.get("origem");
const destino = App.get("destino");
const valorBase = Number(App.get("valorBase") || 0);
const config = App.get("taxasConfig") || {};

  // =========================
// OBSERVAÃ‡ÃƒO
// =========================
if(config.observacao && config.observacao.trim() !== ""){
  document.getElementById("blocoObservacao").style.display = "block";
  document.getElementById("observacaoTxt").innerText = config.observacao;
}

document.getElementById("origemTxt").innerText = origem || "-";
document.getElementById("destinoTxt").innerText = destino || "-";

let total = valorBase;
let detalhes = [];

detalhes.push(["Viagem base", valorBase]);

// Tipo de viagem
if(config.tipoViagem === "bate_volta"){
  const acres = valorBase;
  total += acres;
  detalhes.push(["Bate e volta", acres]);
}

if(config.tipoViagem === "ida_volta"){
  const acres = valorBase;
  total += acres;
  detalhes.push(["Ida e volta", acres]);
}

if(config.tipoViagem === "ida_volta_espera"){
  const acres = valorBase + (valorBase*0.10);
  total += acres;
  detalhes.push(["Ida e volta + espera", acres]);
}

// Taxas fixas
if(config.desvioSimples){
  total += 5;
  detalhes.push(["Desvio rÃ¡pido",5]);
}

if(config.voltaPraia){
  total += 10;
  detalhes.push(["Volta das praias",10]);
}

if(config.taxaFeira){
  total += 5;
  detalhes.push(["Taxa de feira",5]);
}

if(config.veiculo6){
  const acres = valorBase*0.5;
  total += acres;
  detalhes.push(["VeÃ­culo 6 lugares (50%)",acres]);
}

// Animal
if(Number(config.animal)>0){
  total += Number(config.animal);
  detalhes.push(["Transporte animal",Number(config.animal)]);
}

// Espera
if(Number(config.minutosEspera)>=5){
  const min = Number(config.minutosEspera);
  const acres = 3 + ((min-5)*0.60);
  total += acres;
  detalhes.push([`Tempo de espera (${min} min)`,acres]);
}

document.getElementById("detalhamento").innerHTML =
detalhes.map(d=>`
  <div>
    <span>${d[0]}</span>
    <strong>R$ ${Number(d[1]).toFixed(2)}</strong>
  </div>
`).join("");

document.getElementById("total").innerText =
`R$ ${total.toFixed(2)}`;

App.set("total", total);

function enviarWhatsApp(){

  const agora = new Date();

  const dataFormatada = agora.toLocaleDateString("pt-BR");
  const horaFormatada = agora.toLocaleTimeString("pt-BR", {
    hour: "2-digit",
    minute: "2-digit"
  });

  const origem = App.get("origem") || "-";
  const destino = App.get("destino") || "-";
  const total = App.get("total") || 0;
  const pagamento = document.getElementById("formaPagamento").value;
  const config = App.get("taxasConfig") || {};

  App.set("formaPagamento", pagamento);

  const blocoDataHora = 
`*RECIBO DE VIAGEM ğŸš–*

*${dataFormatada}*
*${horaFormatada}*`;
  
  let blocoObservacao = "";

  if(config.observacao && config.observacao.trim() !== ""){
    blocoObservacao = `
_________________________________
*ğŸ“ ObservaÃ§Ãµes*

${config.observacao}`;
  }

  const detalhesTexto = detalhes.map(d =>
    `â€¢ ${d[0]}: R$ ${Number(d[1]).toFixed(2)}`
  ).join("\n");

  const msg =
`${blocoDataHora}
${blocoObservacao}
______________________________
*Detalhamento da Viagem*  

${detalhesTexto}

*Forma de Pagamento:* ${pagamento}
_____________________________
*ğŸ“ ITINERÃRIO*  

ğŸ“Œ *Origem:*
ğŸ‘‰ ${origem}

ğŸ *Destino:*
ğŸ‘‰ ${destino}
_____________________________
ğŸ’° *Total:* R$ ${Number(total).toFixed(2)}
`;

  const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;

  window.open(url, "_blank");
}
</script>

</body>
</html>




