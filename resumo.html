<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resumo ‚Äì RF DRIVER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="core/global.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body{
  background:#000;
  color:#fff;
}

.container{
  padding:30px 20px 140px;
  max-width:420px;
  margin:0 auto;
}

/* LOGO */
.logo-wrapper{
  width:90px;
  height:90px;
  margin:0 auto 20px auto;
  border-radius:50%;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 30px rgba(250,204,21,.35);
}

.logo-img{
  width:70%;
}

/* HEADER */
.header{
  text-align:center;
  margin-bottom:25px;
}

.header h1{
  font-size:1.4rem;
  font-weight:700;
}

.header span{
  font-size:.85rem;
  color:#a1a1aa;
}

/* CARD */
.card{
  background:#111;
  border-radius:16px;
  padding:16px;
  border:1px solid #1c1c1c;
  margin-bottom:18px;
}

.section-title{
  font-size:.85rem;
  color:#a1a1aa;
  margin-bottom:10px;
}

.route span{
  display:block;
  margin-bottom:6px;
}

.details div{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-size:.9rem;
}

/* TOTAL */
.total-box{
  background:#151515;
  border:1px solid #facc15;
  border-radius:18px;
  padding:20px;
  text-align:center;
  margin-bottom:20px;
}

.total{
  font-size:2.2rem;
  font-weight:800;
  color:#facc15;
}

/* SELECT */
select{
  width:100%;
  padding:14px;
  border-radius:14px;
  background:#111;
  color:#fff;
  border:1px solid #1c1c1c;
}

/* BOT√ÉO FIXO */
.cta-area{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  padding:20px;
  background:#000;
}

.cta-primary{
  width:100%;
  padding:18px;
  border:none;
  border-radius:14px;
  font-size:1.05rem;
  font-weight:700;
  background:#facc15;
  color:#000;
  cursor:pointer;
}

.cta-primary:active{
  transform:scale(.97);
}
</style>
</head>

<body>

<div class="container">

  <div class="logo-wrapper">
    <img src="./icons/logo-1024.png" class="logo-img">
  </div>

  <div class="header">
    <h1>Resumo da Viagem</h1>
    <span>Confirme as informa√ß√µes</span>
  </div>

  <!-- ROTA -->
  <div class="card route">
    <div class="section-title">Itiner√°rio</div>
    <span>üìå Origem: <strong id="origemTxt"></strong></span>
    <span>üèÅ Destino: <strong id="destinoTxt"></strong></span>
  </div>

  <!-- DETALHAMENTO -->
  <div class="card">
    <div class="section-title">Detalhamento</div>
    <div class="details" id="detalhamento"></div>
  </div>

  <!-- OBSERVA√á√ÉO -->
  <div class="card" id="blocoObservacao" style="display:none;">
    <div class="section-title">Observa√ß√£o</div>
    <div id="observacaoTxt"></div>
  </div>

  <!-- PAGAMENTO -->
  <div class="card">
    <div class="section-title">Forma de Pagamento</div>
    <select id="formaPagamento">
      <option value="Dinheiro">Dinheiro</option>
      <option value="Pix">Pix</option>
      <option value="Cart√£o">Cart√£o</option>
    </select>
  </div>

  <!-- VIAGEM AGENDADA -->
<div class="card">
  <div class="section-title">Agendamento</div>

  <label style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
    <input type="checkbox" id="viagemAgendada" onchange="toggleAgendamento()" style="width:18px; height:18px;">
    <span>Viagem Agendada</span>
  </label>

  <div id="areaAgendamento" style="display:none;">
    <div style="margin-bottom:10px;">
      <input type="date" id="dataAgendamento"
        style="width:100%; padding:12px; border-radius:12px; background:#111; color:#fff; border:1px solid #1c1c1c;">
    </div>

    <div>
      <input type="time" id="horaAgendamento"
        style="width:100%; padding:12px; border-radius:12px; background:#111; color:#fff; border:1px solid #1c1c1c;">
    </div>
  </div>
</div>

  <!-- TOTAL -->
  <div class="total-box">
    <div class="total" id="total">R$ 0,00</div>
  </div>

</div>

<div class="cta-area">
  <button class="cta-primary" onclick="solicitar()">
    Solicitar Viagem no Grupo AGORA
  </button>
</div>

<script>
const origem = App.get("origem");
const destino = App.get("destino");
const valorBase = Number(App.get("valorBase") || 0);
const config = App.get("taxasConfig") || {};

document.getElementById("origemTxt").innerText = origem || "-";
document.getElementById("destinoTxt").innerText = destino || "-";

if(config.observacao && config.observacao.trim() !== ""){
  document.getElementById("blocoObservacao").style.display = "block";
  document.getElementById("observacaoTxt").innerText = config.observacao;
}

let total = valorBase;
let detalhes = [];

detalhes.push(["Viagem base", valorBase]);

// Tipo
if(config.tipoViagem === "bate_volta"){
  total += valorBase;
  detalhes.push(["Bate e volta", valorBase]);
}

if(config.tipoViagem === "ida_volta"){
  total += valorBase;
  detalhes.push(["Ida e volta", valorBase]);
}

if(config.tipoViagem === "ida_volta_espera"){
  const acres = valorBase + (valorBase*0.10);
  total += acres;
  detalhes.push(["Ida e volta + espera", acres]);
}

// Fixas
if(config.desvioSimples){
  total += 5;
  detalhes.push(["Desvio r√°pido",5]);
}

if(config.voltaPraia){
  total += 10;
  detalhes.push(["Volta das praias",10]);
}

if(config.taxaFeira){
  total += 5;
  detalhes.push(["Taxa de feira",5]);
}

if(config.veiculo6){
  const acres = valorBase*0.5;
  total += acres;
  detalhes.push(["Ve√≠culo 6 lugares (50%)",acres]);
}

// üî• ADICIONAL NOTURNO CORRIGIDO
if(config.taxaNoturna){
  let acres = 0;

  if(valorBase <= 29){
    acres = 5;
    detalhes.push(["Adicional noturno", 5]);
  }else{
    acres = valorBase * 0.35;
    detalhes.push(["Adicional noturno (35%)", acres]);
  }

  total += acres;
}

// Animal
if(Number(config.animal)>0){
  total += Number(config.animal);
  detalhes.push(["Transporte animal",Number(config.animal)]);
}

// Espera
if(Number(config.minutosEspera)>=5){
  const min = Number(config.minutosEspera);
  const acres = 3 + ((min-5)*0.60);
  total += acres;
  detalhes.push([`Tempo de espera (${min} min)`,acres]);
}

document.getElementById("detalhamento").innerHTML =
detalhes.map(d=>`
  <div>
    <span>${d[0]}</span>
    <strong>R$ ${Number(d[1]).toFixed(2)}</strong>
  </div>
`).join("");

document.getElementById("total").innerText =
`R$ ${total.toFixed(2)}`;

App.set("total", total);

  function toggleAgendamento(){
  const check = document.getElementById("viagemAgendada");
  const area = document.getElementById("areaAgendamento");

  area.style.display = check.checked ? "block" : "none";
}

function solicitar(){

  const agora = new Date();

  const dataFormatada = agora.toLocaleDateString("pt-BR");
  const horaFormatada = agora.toLocaleTimeString("pt-BR", {
    hour: "2-digit",
    minute: "2-digit"
  });

  const blocoDataHora = `
*SOLICITA√á√ÉO DE VIAGEM*
*${dataFormatada}*
*${horaFormatada}*`;

  const observacaoInput = document.getElementById("observacaoInput"); // ajuste se necess√°rio
  const observacao = observacaoInput ? observacaoInput.value.trim() : "";

  let blocoObservacao = "";

  if (observacao) {
    blocoObservacao = `
_____________________________
*Observa√ß√µes*

*${observacao}*`;
  }

  // Caso voc√™ tenha checkbox de agendamento
  const viagemAgendada = document.getElementById("viagemAgendada"); 
  const dataAgendamento = document.getElementById("dataAgendamento");
  const horaAgendamento = document.getElementById("horaAgendamento");

  let blocoAgendamento = "";

  if (viagemAgendada && viagemAgendada.checked) {

    if (!dataAgendamento.value || !horaAgendamento.value) {
      alert("Por favor, selecione data e hora do agendamento.");
      return;
    }

    const dataFormatadaAg = new Date(dataAgendamento.value + "T00:00")
      .toLocaleDateString("pt-BR");

    blocoAgendamento = `
_____________________________
*VIAGEM AGENDADA*

üìÜ ${dataFormatadaAg}
‚è∞ ${horaAgendamento.value}
`;
  }

  // Montar detalhamento das taxas
  let detalhesWhats = detalhes.map(d =>
    `‚Ä¢ ${d[0]}: R$ ${Number(d[1]).toFixed(2)}`
  );

  const msg =
`${blocoDataHora}
${blocoObservacao}
_____________________________
*Detalhamento da viagem*

${detalhesWhats.join("\n")}
_____________________________
*ALGU√âM DISPON√çVEL?????*

 *üìå Origem*
üëâ ${origem}

 *üèÅ Destino*
üëâ ${destino}
${blocoAgendamento}
_____________________________
*üí∞ Total: R$ ${total.toFixed(2)}*

*RF Driver*
_58.615.336/0001-49_
_Mobilidade com Excel√™ncia_`;

  const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;

  window.location.href = url;
}
</script>

</body>
</html>





